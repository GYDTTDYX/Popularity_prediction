---
title: "exploratory_analysis"
output:
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
---

```{r include=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(ggplot2)
library(wordcloud2)
library(plotly)
library(glmnet)
library(caret)
library(ROCR)
```

```{r}
df = read.csv("DATA/games.csv")|>
  janitor::clean_names()|>
  subset(select = -c(dlc_count, about_the_game, reviews, header_image, website, support_url, support_email, metacritic_score, metacritic_url, notes, developers, publishers, screenshots, movies, score_rank, average_playtime_two_weeks, median_playtime_two_weeks, average_playtime_forever, peak_ccu, full_audio_languages))|>
  subset(price > 0)

#Change the format of release date. 
df = df|>
  mutate(release_date = as.Date(release_date, format = "%b %d, %Y"))
```

### definition of popular games

```{r}
df_popular = df|>
  subset((positive+negative) > 10)|>
  subset(positive/(positive+negative) > 0.7)|>
  subset(estimated_owners != "0 - 20000")|>
  subset(estimated_owners != "0 - 0")|>
  subset(median_playtime_forever > 120)

df_unpopular = anti_join(df, df_popular, by="app_id")
```

In our project, the exploration of key features of popular games forms a central objective. To establish a precise definition of "popular games" in the context of our analysis, we will primarily adhere to the standard set by Steam, a prominent gaming platform[https://www.reddit.com/r/Steam/comments/ivz45n/what_does_the_steam_ratings_like_very_negative_or/]
According to Steam's rating system, we will categorize games as "popular" if they fall into the following rating categories: mostly positive, positive, very positive, overwhelmingly positive. This approach ensures that we consider user sentiment as a crucial aspect of popularity.

However, we recognize that popularity encompasses more than just ratings; it also pertains to the volume of users who purchase and engage with a game. To account for this broader perspective of popularity, we have incorporated the following criteria:

*Estimated Owners*: We will exclude games with an estimated owner count in the range of 0-0 and 0-20,000. This criteria ensures that we focus on games with a substantial user base.

*Median Playtime*: Games selected for analysis will have a median playtime exceeding 120 minutes. This threshold corresponds to the latest time frame within which Steam allows game refunds. This criterion further refines our definition of popular games by considering active engagement and retention, which are indicative of a game's enduring appeal.

By combining these rating, ownership, and playtime criteria, we aim to create a comprehensive definition of "popular games" that accounts for both user sentiment and the size of the player base, enabling us to explore key features that contribute to a game's popularity in a holistic manner.

### price distribution of popular and unpopular games

*Price summary for popular games*
```{r}
summary(pull(df_popular, price))
```

*Price summary for unpopular games*
```{r}
summary(pull(df_unpopular, price))
```

Based on tables, it is evident that popular games are more expensive than less popular games in every quantile. Such difference might caused by several reasons.

*Mechanics*: Popular games often have complex game mechanics that improve gaming experience. However, developing such mechanics requires time, which leads to higher production costs and reflect on the final price.

*Animation Effects*: The captivating animation effects is a important component for good games. The creation requires hiring skilled artists, which will lead to increasing production cost

*Game Optimization*: Popular games need to ensure smooth gameplay(although we have to admit some popular games still have tons of bugs). Optimization requires talented coder, which increase the production cost. 

Then, we used statistical test to test whether there is difference in the two price distribution. 

```{r}
df_unpopular = df_unpopular|>subset(name != "Ascent Free-Roaming VR Experience")

combined_data = rbind(data.frame(dataset = "unpopular", price = log(df_unpopular$price)),
                       data.frame(dataset = "popular", price = log(df_popular$price)))

ggplot(data = combined_data, aes(x = price, fill = dataset)) +
  geom_histogram(aes(y = ..density..), binwidth = 0.75)+
  facet_grid(~dataset)

```

The two distribution looks approximately normal, so we decide to use T-test to test whether two groups's log transformed price have similar distribution.

H0: they have same mean price
H1: they have different mean price

```{r}
result <- t.test(log(df_popular$price), log(df_unpopular$price))
result
```

The result shows a p-value smaller than 0.05, so we reject the null and conclude that the two groups have different mean price. 

### price distribution of games with different estimated owners
```{r}
# we filter out Ascent Free-Roaming VR Experience since its price is 1000 dollars, which will make it hard to see any trend from our plot. 
df|>
  subset(name != "Ascent Free-Roaming VR Experience")|>
  separate_wider_delim(cols = estimated_owners, delim = " - ", names = c("estimate_low", "estimate_high"))|>
  mutate(estimate_low = as.numeric(estimate_low))|>
  mutate(estimate_high = as.numeric(estimate_high))|>
  mutate(estimate_mean = (estimate_high + estimate_low)/2)|>
  mutate(estimate_mean = factor(estimate_mean))|>
  ggplot(aes(x = estimate_mean, y = price))+
  geom_boxplot()+
  coord_flip()
```

From the price distribution plot of games categorized by different estimated owner counts, a notable pattern emerges. Specifically, games with a greater number of estimated owners tend to exhibit relatively higher prices. However, an intriguing observation is that once a certain threshold of estimated owners is reached, the prices of games begin to decline.

### Overall frequency of keywords(genre, categories, tags)

Here, we try to explore the trend of keywords in genre, categories, tags. 
```{r}
categories_freq = df|>
  separate_rows(categories, sep = ",")|>
  group_by(categories)|>
  summarise(n_obs = n())|>
  arrange(desc(n_obs))|>
  ggplot(aes(x = reorder(categories, +n_obs), y = n_obs))+
  geom_bar(stat="identity")+
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=1)) +
  coord_flip()

categories_freq
```

From the bar plot, it is evident that single-player games have highest frequency in our dataset, this is reasonable since multi-player games require higher optimization, single player games is the best choice for independent game maker. The VR related categories have low frequency in games, this is because the equipment is expensive and the technology is relatively new. 

```{r}
genre_freq = df|>
  separate_rows(genres, sep = ",")|>
  group_by(genres)|>
  summarise(n_obs = n())|>
  arrange(desc(n_obs))|>
  ggplot(aes(x = reorder(genres, +n_obs), y = n_obs))+
  geom_bar(stat="identity")+
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=1)) +
  coord_flip()

genre_freq
```

For the bar plot of genre, besides the most frequency keyword indie, other keywords are common when we talk about games. Sport, Racing, Action, Adventures includes most of the games genere. 

```{r}
tags_freq = df|>
  separate_rows(tags, sep = ",")|>
  group_by(tags)|>
  summarise(n_obs = n())|>
  subset(n_obs >= 5000)|>
  arrange(desc(n_obs))|>
  ggplot(aes(x = reorder(tags, +n_obs), y = n_obs))+
  geom_bar(stat="identity")+
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=1)) +
  coord_flip()

tags_freq
```

As there are too many tags in steam, we only show most frequent tags, interestingly, we found there are more puzzle games compared to RPG, this might because the development cost of puzzle games are lower than RPG. 

### Trend of keywords frequency across different years

It might be informative to visualize the trend change of game genre developed in different years since WOW might be good game at 2000s, while games like Overwatch might be better game in 2020s. 

```{r}
genre_freq_year = df|>
  mutate(year = year(release_date))|>
  separate_rows(genres, sep = ",")|>
  group_by(year, genres)|>
  summarise(n_obs = n())|>
  group_by(year)

genre_freq_year_total = df|>
  mutate(year = year(release_date))|>
  separate_rows(genres, sep = ",")|>
  group_by(year)|>
  summarise(n_obs_total = n())
  

genre_freq_year_total|>
  knitr::kable()
```

We could see from the table that there are very few games on steam before 2006, genre frequency might be strongly affected by randomness in those years, so we choose only to plot the trend after 2005. 
```{r}
#here we limit the year to later than 2002 since steam is lauched in 2002, we think the game before 2002 might be not representative. 
left_join(genre_freq_year, genre_freq_year_total, by = "year")|>
  subset(year > 2005)|>
  mutate(genre_ratio = n_obs/n_obs_total)|>
  ungroup()|>
  plot_ly(x = ~year, y = ~genre_ratio, color = ~genres, type = "scatter", mode = "lines+markers",  colors = "viridis")
```

```{r}
popular_genres_bar_plot = left_join(genre_freq_year, genre_freq_year_total, by = "year")|>
  subset(year > 2005)|>
  mutate(genre_ratio = n_obs/n_obs_total)|>
  ggplot(aes(x = year, y = genre_ratio, fill = genres)) + 
  geom_col(position = 'stack', width = 0.6)+
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=1))
popular_genres_bar_plot
```

We found some interesting trend from the line plot:

*Rise of Indie Games*: We notice that the genre "indie" increase in recent years, particularly after year 2012. This increase might caused by more accessible personal computer and no-code platform like RPG-maker, which made it easier for independent game developers to create their games. 

*Shift in Genre Popularity*: The line plot also show a decrease frequency of Action games. Although we have to admit it is still one of the most frequent genere, it experienced a decline in recent years. This shift may be caused by changing in player preferences. Since most old games are action games, players might seek new genre when there are available ones. It suggests that players are increasingly seeking a wider variety of genre. 

*Casual Games on the Rise*: We noticed there is an increase in the frequency of "Casual" games. This reveals that as the first generation that familiar with computer gradually enter job market, games that are relaxing are more preferable for them. 

*Early Access Strategy*: The "Early Access" games on Steam experienced a notable increase. This prosperous new business model in game area shows the potential of games. 

### Word Cloud visualization
Wordcloud could help visualize the the frequency of keywords in different groups. Here, we separately create word cloud for popular and unpopular games. 

```{r}
overwhelm_popular_wordcloud = df|>
  subset((positive+negative) > 500)|>
  subset(positive/(positive+negative) > 0.95)|>
  separate_rows(tags, sep = ",")|>
  group_by(tags)|>
  summarise(n_obs = n())|>
  wordcloud2()

popular_tags_wordcloud = df_popular|>
  separate_rows(tags, sep = ",")|>
  group_by(tags)|>
  summarise(n_obs = n())|>
  wordcloud2()

unpopular_tags_wordcloud = df_unpopular|>
  separate_rows(tags, sep = ",")|>
  group_by(tags)|>
  summarise(n_obs = n())|>
  wordcloud2()
```

overwhelm popular games' wordcloud
```{r}
overwhelm_popular_wordcloud
```

popular games' wordcloud
```{r}
popular_tags_wordcloud
```

unpopular games' wordcloud
```{r}
unpopular_tags_wordcloud
```

We can observe differences among the three word clouds above.

We notice that the tag "difficult" appears more frequently in the word cloud for popular games. This aligns with reality, as some of the best games in history, such as Elden Ring and Sekiro: Shadows Die Twice, are known for their challenging gameplay.

An interesting observation is that the ratio of 2D games to 3D games is higher in popular games compared to unpopular ones. This is reasonable since plot and game mechanics often take precedence in game development. Small studios may struggle to allocate sufficient resources to create high-quality 3D environments, prompting them to opt for 2D games more frequently. This contributes to the higher frequency of 2D games in the popular category.